datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Question {
  id               Int     @id @default(autoincrement())
  subject          String
  topic            String
  subtopic         String
  chapterId        String
  difficulty       String?
  passage          String? // üëà NAYI LINE: English passage ke liye
  passageHindi     String?
  question         String
  questionHindi    String?
  options          String  // SQLite arrays support nahi karta, isliye isko String rakha hai
  answer           String
  explanation      String?
  explanationHindi String?
  examReference    String?
  geometryType     String?
  geometryData     String?
  flags            FlaggedQuestion[]
}

// ... aapka purana Question model yahan upar rahega ...

// Aapka updated User model
model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  isPremium Boolean  @default(false)
  premiumExpiry DateTime?
  createdAt DateTime @default(now())
  results   Result[] // üëà Nayi line: Ek user ke bohot saare results ho sakte hain
  tickets   SupportTicket[]
  notifications Notification[]
}

// üèÜ NAYA MODEL: Results save karne ke liye
model Result {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  subject   String   // Jaise: Maths
  topic     String   // Jaise: Number System
  score     Int      // Kitne marks aaye
  total     Int      // Total kitne marks ka tha
  createdAt DateTime @default(now())
}

model SupportTicket {
  id         Int      @id @default(autoincrement())
  userId     Int
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  subject    String
  message    String
  adminReply String?  // Admin ka reply
  status     String   @default("OPEN") // "OPEN" ya "RESOLVED"
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model FlaggedQuestion {
  id          Int      @id @default(autoincrement())
  questionId  Int
  question    Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  reason      String   // "Wrong Answer", "Typo", etc.
  status      String   @default("OPEN") // "OPEN" ya "RESOLVED"
  createdAt   DateTime @default(now())
}

model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  title     String
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}

model CommunityPost {
  id                 String   @id @default(uuid())
  question           String
  options            String[]
  correctOptionIndex Int
  likes              Int      @default(0)
  views              Int      @default(0)
  comments           Int      @default(0)
  createdAt          DateTime @default(now())
  // üî• NEW FIELDS FOR SMART CURRENT AFFAIRS SYSTEM
  questionHindi      String?
  explanationHindi   String?
  isCurrentAffair    Boolean  @default(false)
  region             String?  // e.g., "Assam" or "General"
  topic              String?  // e.g., "Sports", "Science"
  explanation        String?
  publishDate        String?  // Format: "YYYY-MM-DD"
  commentsList       CommunityComment[]
}

// üî• NEW: Comment Model
model CommunityComment {
  id        String   @id @default(uuid())
  text      String
  author    String   // Store user's name
  postId    String
  post      CommunityPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}